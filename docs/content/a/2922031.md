---
title: "[Q#2921945][A#2922031] Useful example of a shutdown hook in Java?"
question_title: "Useful example of a shutdown hook in Java?"
question_text: "I'm trying to make sure my Java application takes reasonable steps to be robust, and part of that involves shutting down gracefully. I am reading about shutdown hooks and I don't actually get how to make use of them in practice. Is there a practical example out there? Let's say I had a really simple application like this one below, which writes numbers to a file, 10 to a line, in batches of 100, and I want to make sure a given batch finishes if the program is interrupted. I get how to register a shutdown hook but I have no idea how to integrate that into my application. Any suggestions?"
answer_text: "You could do the following: Some sketchy code: In run() you change to In main() you add: That's roughly how I do a graceful \"reject all clients upon hitting Control-C\" in terminal. From the docs: When the virtual machine begins its shutdown sequence it will start all registered shutdown hooks in some unspecified order and let them run concurrently. When all the hooks have finished it will then run all uninvoked finalizers if finalization-on-exit has been enabled. Finally, the virtual machine will halt. That is, a shutdown hook keeps the JVM running until the hook has terminated (returned from the run()-method."
apization_code: "package com.stackoverflow.api;  /**  * Useful example of a shutdown hook in Java?  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/2922031\">https://stackoverflow.com/a/2922031</a>  */ public class APIzator2922031 {    public static void example() throws RuntimeException {     for (int i = 0; i < N && keepRunning; ++i) writeBatch(pw, i);     final Thread mainThread = Thread.currentThread();     Runtime       .getRuntime()       .addShutdownHook(         new Thread() {            public void run() {             keepRunning = false;             mainThread.join();           }         }       );   } }"
---

https://stackoverflow.com/q/2921945

I&#x27;m trying to make sure my Java application takes reasonable steps to be robust, and part of that involves shutting down gracefully. I am reading about shutdown hooks and I don&#x27;t actually get how to make use of them in practice.
Is there a practical example out there?
Let&#x27;s say I had a really simple application like this one below, which writes numbers to a file, 10 to a line, in batches of 100, and I want to make sure a given batch finishes if the program is interrupted. I get how to register a shutdown hook but I have no idea how to integrate that into my application. Any suggestions?


<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
package com.example.test.concurrency;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.PrintWriter;

public class GracefulShutdownTest1 {
    final private int N;
    final private File f;
    public GracefulShutdownTest1(File f, int N) { this.f=f; this.N = N; }

    public void run()
    {
        PrintWriter pw = null;
        try {
            FileOutputStream fos = new FileOutputStream(this.f);
            pw = new PrintWriter(fos);
            for (int i = 0; i < N; ++i)
                writeBatch(pw, i);
        }
        catch (FileNotFoundException e) {
            e.printStackTrace();
        }
        finally
        {
            pw.close();
        }       
    }

    private void writeBatch(PrintWriter pw, int i) {
        for (int j = 0; j < 100; ++j)
        {
            int k = i*100+j;
            pw.write(Integer.toString(k));
            if ((j+1)%10 == 0)
                pw.write('\n');
            else
                pw.write(' ');
        }
    }

    static public void main(String[] args)
    {
        if (args.length < 2)
        {
            System.out.println("args = [file] [N] "
                    +"where file = output filename, N=batch count");
        }
        else
        {
            new GracefulShutdownTest1(
                    new File(args[0]), 
                    Integer.parseInt(args[1])
            ).run();
        }
    }
}
```


## Original code snippet

https://stackoverflow.com/a/2922031

You could do the following:
Some sketchy code:
In run() you change to
In main() you add:
That&#x27;s roughly how I do a graceful &quot;reject all clients upon hitting Control-C&quot; in terminal.
From the docs:
When the virtual machine begins its shutdown sequence it will start all registered shutdown hooks in some unspecified order and let them run concurrently. When all the hooks have finished it will then run all uninvoked finalizers if finalization-on-exit has been enabled. Finally, the virtual machine will halt.
That is, a shutdown hook keeps the JVM running until the hook has terminated (returned from the run()-method.

<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
for (int i = 0; i < N && keepRunning; ++i)
    writeBatch(pw, i);
final Thread mainThread = Thread.currentThread();
Runtime.getRuntime().addShutdownHook(new Thread() {
    public void run() {
        keepRunning = false;
        mainThread.join();
    }
});
```

## Produced APIzation

[`APIzator2922031.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/search/APIzator2922031.java)

<div class="code-logo"><img src="/apizator.png" /></div>

```java
package com.stackoverflow.api;

/**
 * Useful example of a shutdown hook in Java?
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/2922031">https://stackoverflow.com/a/2922031</a>
 */
public class APIzator2922031 {

  public static void example() throws RuntimeException {
    for (int i = 0; i < N && keepRunning; ++i) writeBatch(pw, i);
    final Thread mainThread = Thread.currentThread();
    Runtime
      .getRuntime()
      .addShutdownHook(
        new Thread() {

          public void run() {
            keepRunning = false;
            mainThread.join();
          }
        }
      );
  }
}

```