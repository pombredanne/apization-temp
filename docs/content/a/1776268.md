---
title: "[Q#1776142][A#1776268] getOutputStream() has already been called for this response"
question_title: "getOutputStream() has already been called for this response"
question_text: "I google the error message getOutputStream() has already been called for this response and many people said it is because of the space or newline after <% or %>, but in my code , there is no a space or a newline. I am using tomcat6 on linux. ~ root cause"
answer_text: "Ok, you should be using a servlet not a JSP but if you really need to...  add this directive at the top of your page: Or in the jsp-config section your web.xml Also flush/close the OutputStream and return when done."
apization_code: "package com.stackoverflow.api;  import java.util.logging.StreamHandler;  /**  * getOutputStream() has already been called for this response  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/1776268\">https://stackoverflow.com/a/1776268</a>  */ public class APIzator1776268 {    public static void call(StreamHandler dataOutput) throws RuntimeException {     dataOutput.flush();     dataOutput.close();     return;   } }"
---

https://stackoverflow.com/q/1776142

I google the error message getOutputStream() has already been called for this response
and many people said it is because of the space or newline after &lt;% or %&gt;, but in my code , there is no a space or a newline. I am using tomcat6 on linux.
~
root cause


```java
<%@
    page import="java.servlet.*,
    javax.servlet.http.*,
    java.io.*,
    java.util.*,
    com.lowagie.text.pdf.*,
    com.lowagie.text.*"
    %><%
    response.setContentType("application/pdf");
    Document document = new Document();
    try{
        ByteArrayOutputStream buffer = new ByteArrayOutputStream();
        PdfWriter.getInstance(document, buffer);
        document.open();
        PdfPTable table = new PdfPTable(2);
        table.addCell("1");
        table.addCell("2");
        table.addCell("3");
        table.addCell("4");
        table.addCell("5");
        table.addCell("6");
        document.add(table);
        document.close();
        DataOutput dataOutput = new DataOutputStream(response.getOutputStream());
        byte[] bytes = buffer.toByteArray();
        response.setContentLength(bytes.length);
        for(int i = 0; i < bytes.length; i++)
        {
        dataOutput.writeByte(bytes[i]);
        }
    }catch(DocumentException e){
        e.printStackTrace();
    }

%>
org.apache.jasper.JasperException: java.lang.IllegalStateException: getOutputStream() has already been called for this response
    org.apache.jasper.servlet.JspServletWrapper.handleJspException(JspServletWrapper.java:522)
    org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:410)
    org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342)
    org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
java.lang.IllegalStateException: getOutputStream() has already been called for this response
    org.apache.catalina.connector.Response.getWriter(Response.java:610)
    org.apache.catalina.connector.ResponseFacade.getWriter(ResponseFacade.java:198)
    org.apache.jasper.runtime.JspWriterImpl.initOut(JspWriterImpl.java:125)
    org.apache.jasper.runtime.JspWriterImpl.flushBuffer(JspWriterImpl.java:118)
    org.apache.jasper.runtime.PageContextImpl.release(PageContextImpl.java:188)
    org.apache.jasper.runtime.JspFactoryImpl.internalReleasePageContext(JspFactoryImpl.java:118)
    org.apache.jasper.runtime.JspFactoryImpl.releasePageContext(JspFactoryImpl.java:77)
    org.apache.jsp.Account.Domain.testPDF_jsp._jspService(testPDF_jsp.java:94)
    org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
    org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:374)
    org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:342)
    org.apache.jasper.servlet.JspServlet.service(JspServlet.java:267)
    javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
```


## Original code snippet

https://stackoverflow.com/a/1776268

Ok, you should be using a servlet not a JSP but if you really need to...  add this directive at the top of your page:
Or in the jsp-config section your web.xml
Also flush/close the OutputStream and return when done.

```java
<%@ page trimDirectiveWhitespaces="true" %>
<jsp-config>
  <jsp-property-group>
    <url-pattern>*.jsp</url-pattern>
    <trim-directive-whitespaces>true</trim-directive-whitespaces>
  </jsp-property-group>
</jsp-config>
dataOutput.flush();
dataOutput.close();
return;
```

## Produced APIzation

[`APIzator1776268.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/apizations/java/APIzator1776268.java)

```java
package com.stackoverflow.api;

import java.util.logging.StreamHandler;

/**
 * getOutputStream() has already been called for this response
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/1776268">https://stackoverflow.com/a/1776268</a>
 */
public class APIzator1776268 {

  public static void call(StreamHandler dataOutput) throws RuntimeException {
    dataOutput.flush();
    dataOutput.close();
    return;
  }
}

```