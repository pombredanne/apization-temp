---
title: "[Q#18778240][A#18778501] Solve error javax.mail.AuthenticationFailedException"
question_title: "Solve error javax.mail.AuthenticationFailedException"
question_text: "I'm not familiar with this function to send mail in java. I'm getting an error while sending email to reset password. Hope you can give me a solution. Below is my code: Throws the following error:"
answer_text: "You should change the port to 587, I tested your code and it's working fine If error still happens, please change session variable to code below:"
apization_code: "package com.stackoverflow.api;  import ch.ethz.ssh2.Session;  /**  * Solve error javax.mail.AuthenticationFailedException  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/18778501\">https://stackoverflow.com/a/18778501</a>  */ public class APIzator18778501 {    public static Session javaxmail() throws RuntimeException {     return Session.getInstance(       props,       new javax.mail.Authenticator() {          protected PasswordAuthentication getPasswordAuthentication() {           return new PasswordAuthentication(userName, password);         }       }     );   } }"
---

https://stackoverflow.com/q/18778240

I&#x27;m not familiar with this function to send mail in java. I&#x27;m getting an error while sending email to reset password. Hope you can give me a solution.
Below is my code:
Throws the following error:


<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
public synchronized static boolean sendMailAdvance(String emailTo, String subject, String body)
{
String host = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-ADDRESS");
String userName = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-USERNAME");
String password = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-PASSWORD");
String port = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-PORT");
String starttls = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-STARTTLS");
String socketFactoryClass = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-SOCKET-CLASS");
String fallback = AppConfigManager.getProperty("SENDER-EMAIL-SMTP-ALLOW-FALLBACK");                         

        try
        {
            java.util.Properties props = null;
            props = System.getProperties();
            props.put("mail.smtp.user", userName);
            props.put("mail.smtp.host", host);
            props.put("mail.smtp.auth", "true");
            props.put("mail.smtp.debug", "true");

            if(!"".equals(port))
            {
                props.put("mail.smtp.port", port);
                props.put("mail.smtp.socketFactory.port", port);
            }

            if(!"".equals(starttls))
                props.put("mail.smtp.starttls.enable",starttls);

            if(!"".equals(socketFactoryClass))
                props.put("mail.smtp.socketFactory.class",socketFactoryClass);

            if(!"".equals(fallback))
                props.put("mail.smtp.socketFactory.fallback", fallback);

            Session session = Session.getDefaultInstance(props, null);
            session.setDebug(true);

            MimeMessage msg = new MimeMessage(session);
            msg.setFrom(new InternetAddress(userName));
            msg.setSubject(subject);                
            msg.setText(body, "ISO-8859-1");
            msg.setSentDate(new Date());
            msg.setHeader("content-Type", "text/html;charset=\"ISO-8859-1\"");
            msg.addRecipient(Message.RecipientType.TO, new InternetAddress(emailTo));
            msg.saveChanges();

            Transport transport = session.getTransport("smtp");
            transport.connect(host, userName, password);
            transport.sendMessage(msg, msg.getAllRecipients());
            transport.close();

            return true;
        }
        catch (Exception mex)
        {
            mex.printStackTrace();
            return false;
        }
}
DEBUG: setDebug: JavaMail version 1.4.1ea-SNAPSHOT
DEBUG: getProvider() returning   javax.mail.Provider[TRANSPORT,smtp,com.sun.mail.smtp.SMTPTransport,Sun Microsystems, Inc]
DEBUG SMTP: useEhlo true, useAuth true
DEBUG SMTP: trying to connect to host "smtp.gmail.com", port 465, isSSL false 220 mx.google.com ESMTP m4sm5929870pbg.38 - gsmtp
DEBUG SMTP: connected to host "smtp.gmail.com", port: 465
EHLO fatin
250-mx.google.com at your service, [175.139.198.14]
250-SIZE 35882577
250-8BITMIME
250-AUTH LOGIN PLAIN XOAUTH XOAUTH2 PLAIN-CLIENTTOKEN
250-ENHANCEDSTATUSCODES
250 CHUNKING
DEBUG SMTP: Found extension "SIZE", arg "35882577"
DEBUG SMTP: Found extension "8BITMIME", arg ""
DEBUG SMTP: Found extension "AUTH", arg "LOGIN PLAIN XOAUTH XOAUTH2 PLAIN-CLIENTTOKEN"
DEBUG SMTP: Found extension "ENHANCEDSTATUSCODES", arg ""
DEBUG SMTP: Found extension "CHUNKING", arg ""
DEBUG SMTP: Attempt to authenticate
AUTH LOGIN
334 VXNlcm5hbWU6
YWNjb3VudEBibG9vbWluZy5jb20ubXk=
334 UGFzc3dvcmQ6
Ymxvb21pbmc=
535-5.7.8 Username and Password not accepted. Learn more at
535 5.7.8 http://support.google.com/mail/bin/answer.py?answer=14257 m4sm5929870pbg.38 - gsmtp
[STDOUT] javax.mail.AuthenticationFailedException
[STDOUT] at javax.mail.Service.connect(Service.java:319)
[STDOUT] at javax.mail.Service.connect(Service.java:169)
[STDOUT] at com.vlee.util.mail.SendMail.sendMailAdvance(SendMail.java:283)
[STDOUT] at com.vlee.servlet.ecommerce.DoMemberLogin.fnSendPwd(DoMemberLogin.java:251)
[STDOUT] at com.vlee.servlet.ecommerce.DoMemberLogin.doPost(DoMemberLogin.java:72)
```


## Original code snippet

https://stackoverflow.com/a/18778501

You should change the port to 587, I tested your code and it&#x27;s working fine
If error still happens, please change session variable to code below:

<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
Session session = Session.getInstance(props, new javax.mail.Authenticator() {
    protected PasswordAuthentication getPasswordAuthentication() {
        return new PasswordAuthentication(userName, password);
    }
});
```

## Produced APIzation

[`APIzator18778501.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/search/APIzator18778501.java)

<div class="code-logo"><img src="/apizator.png" /></div>

```java
package com.stackoverflow.api;

import ch.ethz.ssh2.Session;

/**
 * Solve error javax.mail.AuthenticationFailedException
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/18778501">https://stackoverflow.com/a/18778501</a>
 */
public class APIzator18778501 {

  public static Session javaxmail() throws RuntimeException {
    return Session.getInstance(
      props,
      new javax.mail.Authenticator() {

        protected PasswordAuthentication getPasswordAuthentication() {
          return new PasswordAuthentication(userName, password);
        }
      }
    );
  }
}

```