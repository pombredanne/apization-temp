---
title: "[Q#7216969][A#20748064] Getting RSA private key from PEM BASE64 Encoded private key file"
question_title: "Getting RSA private key from PEM BASE64 Encoded private key file"
question_text: "I have a private key file (PEM BASE64 encoded). I want to use it else where to decrypt some other data.Using Java i tried to read the file and decode the BASE64 encoded data in it... This is the code snippet which i tried.... I am getting the following errors The contents of the file \"privatekey.key\" Similar questions have been posted here, but those were of no avail for me.  Almost all of them suggested using Bouncycastle provider which am not willing to use as am supposed to use a provider which is FIPS compliant and am not sure if BC provider is FIPS compliant. A help in gettin me out of this would be highly appreciated... Thanks in advance."
answer_text: "Parsing PKCS1 (only PKCS8 format works out of the box on Android) key turned out to be a tedious task on Android because of the lack of ASN1 suport, yet solvable if you include Spongy castle jar to read DER Integers."
apization_code: "package com.stackoverflow.api;  import java.io.IOException; import java.math.BigInteger; import java.security.KeyFactory; import java.security.NoSuchAlgorithmException; import java.security.PrivateKey; import java.security.spec.InvalidKeySpecException; import java.security.spec.RSAPrivateKeySpec; import java.util.Enumeration; import java.util.prefs.Base64; import org.bouncycastle.asn1.ASN1Sequence; import org.bouncycastle.asn1.DERInteger;  /**  * Getting RSA private key from PEM BASE64 Encoded private key file  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/20748064\">https://stackoverflow.com/a/20748064</a>  */ public class APIzator20748064 {    public static void getKey() throws RuntimeException {     String privKeyPEM = key       .replace(\"-----BEGIN RSA PRIVATE KEY-----\\n\", \"\")       .replace(\"-----END RSA PRIVATE KEY-----\", \"\");     // Base64 decode the data     byte[] encodedPrivateKey = Base64.decode(privKeyPEM, Base64.DEFAULT);     try {       ASN1Sequence primitive = (ASN1Sequence) ASN1Sequence.fromByteArray(         encodedPrivateKey       );       Enumeration<?> e = primitive.getObjects();       BigInteger v = ((DERInteger) e.nextElement()).getValue();       int version = v.intValue();       if (version != 0 && version != 1) {         throw new IllegalArgumentException(\"wrong version for RSA private key\");       }       /**        * In fact only modulus and private exponent are in use.        */       BigInteger modulus = ((DERInteger) e.nextElement()).getValue();       BigInteger publicExponent = ((DERInteger) e.nextElement()).getValue();       BigInteger privateExponent = ((DERInteger) e.nextElement()).getValue();       BigInteger prime1 = ((DERInteger) e.nextElement()).getValue();       BigInteger prime2 = ((DERInteger) e.nextElement()).getValue();       BigInteger exponent1 = ((DERInteger) e.nextElement()).getValue();       BigInteger exponent2 = ((DERInteger) e.nextElement()).getValue();       BigInteger coefficient = ((DERInteger) e.nextElement()).getValue();       RSAPrivateKeySpec spec = new RSAPrivateKeySpec(modulus, privateExponent);       KeyFactory kf = KeyFactory.getInstance(\"RSA\");       PrivateKey pk = kf.generatePrivate(spec);     } catch (IOException e2) {       throw new IllegalStateException();     } catch (NoSuchAlgorithmException e) {       throw new IllegalStateException(e);     } catch (InvalidKeySpecException e) {       throw new IllegalStateException(e);     }   } }"
---

https://stackoverflow.com/q/7216969

I have a private key file (PEM BASE64 encoded). I want to use it else where to decrypt some other data.Using Java i tried to read the file and decode the BASE64 encoded data in it...
This is the code snippet which i tried....
I am getting the following errors
The contents of the file &quot;privatekey.key&quot;
Similar questions have been posted here, but those were of no avail for me. 
Almost all of them suggested using Bouncycastle provider which am not willing to use as am supposed to use a provider which is FIPS compliant and am not sure if BC provider is FIPS compliant.
A help in gettin me out of this would be highly appreciated...
Thanks in advance.


<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
import java.io.*;
import java.nio.ByteBuffer;
import java.security.*;
import java.security.spec.PKCS8EncodedKeySpec;
import com.ibm.crypto.fips.provider.RSAPrivateKey;
import com.ibm.misc.BASE64Decoder;

public class GetPrivateKey {
    public static RSAPrivateKey get() throws Exception {
        File privateKeyFile = new File("privatekey.key");
        byte[] encodedKey = new byte[(int) privateKeyFile.length()];
        new FileInputStream(privateKeyFile).read(encodedKey);
        ByteBuffer keyBytes = new BASE64Decoder().decodeBufferToByteBuffer(encodedKey.toString());
        PKCS8EncodedKeySpec privateKeySpec = new PKCS8EncodedKeySpec(keyBytes.array());
        KeyFactory kf = KeyFactory.getInstance("RSA", "IBMJCEFIPS");
        RSAPrivateKey pk = (RSAPrivateKey) kf.generatePrivate(privateKeySpec);
        return pk;
    }

    public static void main(String[] args) throws Exception {
        PrivateKey privKey = FormatMePlease.get();
        System.out.println(privKey.toString());
    }

}
Exception in thread "main" java.security.spec.InvalidKeySpecException: Inappropriate key specification: DerInputStream.getLength(): lengthTag=127, too big.
at com.ibm.crypto.fips.provider.RSAKeyFactory.b(Unknown Source)
at com.ibm.crypto.fips.provider.RSAKeyFactory.engineGeneratePrivate(Unknown Source)
at java.security.KeyFactory.generatePrivate(Unknown Source)
at GetPrivateKey.get(GetPrivateKey.java:24)
at GetPrivateKey.main(GetPrivateKey.java:29)
-----BEGIN RSA PRIVATE KEY-----
MIIEuwIBADANBgkqhkiG9w0BAQEFAASCBKUwggShAgEAAoIBAF53wUbKmDHtvfOb8u1HPqEBFNNF
csnOMjIcSEhAwIQMbgrOuQ+vH/YgXuuDJaURS85H8P4UTt6lYOJn+SFnXvS82E7LHJpVrWwQzbh2
QKh13/akPe90DlNTUGEYO7rHaPLqTlld0jkLFSytwqfwqn9yrYpM1ncUOpCciK5j8t8MzO71LJoJ
g24CFxpjIS0tBrJvKzrRNcxWSRDLmu2kNmtsh7yyJouE6XoizVmBmNVltHhFaDMmqjugMQA2CZfL
rxiR1ep8TH8IBvPqysqZI1RIpB/e0engP4/1KLrOt+6gGS0JEDh1kG2fJObl+N4n3sCOtgaz5Uz8
8jpwbmZ3Se8CAwEAAQKCAQAdOsSs2MbavAsIM3qo/GBehO0iqdxooMpbQvECmjZ3JTlvUqNkPPWQ
vFdiW8PsHTvtackhdLsqnNUreKxXL5rr8vqi9qm0/0mXpGNi7gP3m/FeaVdYnfpIwgCe6lag5k6M
yv7PG/6N8+XrWyBdwlOe96bGohvB4Jp2YFjSTM67QONQ8CdmfqokqJ8/3RyrpDvGN3iX3yzBqXGO
jPkoJQv3I4lsYdR0nl4obHHnMSeWCQCYvJoZ7ZOliu/Dd0ksItlodG6s8r/ujkSa8VIhe0fnXTf0
i7lqa55CAByGN4MOR0bAkJwIB7nZzQKurBPcTAYJFFvAc5hgMnWT0XW83TehAoGBALVPGnznScUw
O50OXKI5yhxGf/XDT8g28L8Oc4bctRzI+8YfIFfLJ57uDGuojO/BpqtYmXmgORru0jYR8idEkZrx
gf62czOiJrCWTkBCEMtrNfFHQJQCQrjfbHofp7ODnEHbHFm7zdlbfNnEBBaKXxd2rVv4UTEhgftv
wsHcimbXAoGBAIViWrHWElMeQT0datqlThE/u51mcK4VlV7iRWXVa1/gAP85ZAu44VvvDlkpYVkF
zSRR+lHSOzsubDMN45OBQW6UA3RPg4TCvrTOmhQUeF5XPuSdcD0R2At6pdaLwAKnOtILg13Ha6ym
Igjv8glodvem3hWLmpHIhNBiaXtf8wqpAoGADH5a8OhvKOtd8EChGXyp9LDW+HRw9vbyN/gi9dQX
ltgyoUBb1jDllgoJSRHgRFUvyvbb/ImR5c03JwqtiQ8siWTC9G5WGeS+jcSNt9fVmG7W1L14MbrG
Jj8fFns/7xrOlasnlPdgA+5N+CONtI/sZY2D/KZr0drhPhZBcWJlFxkCgYAn+4SOPEo/6hjKNhA6
vER7fSxDEVsDg+rDh3YgAWpvUdlaqBxqOyAqi600YugQZGHK2lv7vNYOdmrunuIx7BPuDqY+bjtR
R4Mc9bVQAZbXSLXMl7j2RWwKfNhLSJbk9LX4EoVtTgLjvOUE4tAdq9fFgpqdwLwzqPTO9kECP4++
CQKBgH6tO/xcNxG/uXUideluAn3H2KeyyznZMJ7oCvzf26/XpTAMI243OoeftiKVMgxuZ7hjwqfn
/VHXABc4i5gchr9RzSb1hZ/IqFzq2YGmbppg5Ok2cgwalDoDBi21bRf8aDRweL62mO+7aPnCQZ58
j5W72PB8BAr6xg0Oro25O4os
-----END RSA PRIVATE KEY-----
```


## Original code snippet

https://stackoverflow.com/a/20748064

Parsing PKCS1 (only PKCS8 format works out of the box on Android) key turned out to be a tedious task on Android because of the lack of ASN1 suport, yet solvable if you include Spongy castle jar to read DER Integers.

<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
String privKeyPEM = key.replace(
"-----BEGIN RSA PRIVATE KEY-----\n", "")
    .replace("-----END RSA PRIVATE KEY-----", "");

// Base64 decode the data

byte[] encodedPrivateKey = Base64.decode(privKeyPEM, Base64.DEFAULT);

try {
    ASN1Sequence primitive = (ASN1Sequence) ASN1Sequence
        .fromByteArray(encodedPrivateKey);
    Enumeration<?> e = primitive.getObjects();
    BigInteger v = ((DERInteger) e.nextElement()).getValue();

    int version = v.intValue();
    if (version != 0 && version != 1) {
        throw new IllegalArgumentException("wrong version for RSA private key");
    }
    /**
     * In fact only modulus and private exponent are in use.
     */
    BigInteger modulus = ((DERInteger) e.nextElement()).getValue();
    BigInteger publicExponent = ((DERInteger) e.nextElement()).getValue();
    BigInteger privateExponent = ((DERInteger) e.nextElement()).getValue();
    BigInteger prime1 = ((DERInteger) e.nextElement()).getValue();
    BigInteger prime2 = ((DERInteger) e.nextElement()).getValue();
    BigInteger exponent1 = ((DERInteger) e.nextElement()).getValue();
    BigInteger exponent2 = ((DERInteger) e.nextElement()).getValue();
    BigInteger coefficient = ((DERInteger) e.nextElement()).getValue();

    RSAPrivateKeySpec spec = new RSAPrivateKeySpec(modulus, privateExponent);
    KeyFactory kf = KeyFactory.getInstance("RSA");
    PrivateKey pk = kf.generatePrivate(spec);
} catch (IOException e2) {
    throw new IllegalStateException();
} catch (NoSuchAlgorithmException e) {
    throw new IllegalStateException(e);
} catch (InvalidKeySpecException e) {
    throw new IllegalStateException(e);
}
```

## Produced APIzation

[`APIzator20748064.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/search/APIzator20748064.java)

<div class="code-logo"><img src="/apizator.png" /></div>

```java
package com.stackoverflow.api;

import java.io.IOException;
import java.math.BigInteger;
import java.security.KeyFactory;
import java.security.NoSuchAlgorithmException;
import java.security.PrivateKey;
import java.security.spec.InvalidKeySpecException;
import java.security.spec.RSAPrivateKeySpec;
import java.util.Enumeration;
import java.util.prefs.Base64;
import org.bouncycastle.asn1.ASN1Sequence;
import org.bouncycastle.asn1.DERInteger;

/**
 * Getting RSA private key from PEM BASE64 Encoded private key file
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/20748064">https://stackoverflow.com/a/20748064</a>
 */
public class APIzator20748064 {

  public static void getKey() throws RuntimeException {
    String privKeyPEM = key
      .replace("-----BEGIN RSA PRIVATE KEY-----\n", "")
      .replace("-----END RSA PRIVATE KEY-----", "");
    // Base64 decode the data
    byte[] encodedPrivateKey = Base64.decode(privKeyPEM, Base64.DEFAULT);
    try {
      ASN1Sequence primitive = (ASN1Sequence) ASN1Sequence.fromByteArray(
        encodedPrivateKey
      );
      Enumeration<?> e = primitive.getObjects();
      BigInteger v = ((DERInteger) e.nextElement()).getValue();
      int version = v.intValue();
      if (version != 0 && version != 1) {
        throw new IllegalArgumentException("wrong version for RSA private key");
      }
      /**
       * In fact only modulus and private exponent are in use.
       */
      BigInteger modulus = ((DERInteger) e.nextElement()).getValue();
      BigInteger publicExponent = ((DERInteger) e.nextElement()).getValue();
      BigInteger privateExponent = ((DERInteger) e.nextElement()).getValue();
      BigInteger prime1 = ((DERInteger) e.nextElement()).getValue();
      BigInteger prime2 = ((DERInteger) e.nextElement()).getValue();
      BigInteger exponent1 = ((DERInteger) e.nextElement()).getValue();
      BigInteger exponent2 = ((DERInteger) e.nextElement()).getValue();
      BigInteger coefficient = ((DERInteger) e.nextElement()).getValue();
      RSAPrivateKeySpec spec = new RSAPrivateKeySpec(modulus, privateExponent);
      KeyFactory kf = KeyFactory.getInstance("RSA");
      PrivateKey pk = kf.generatePrivate(spec);
    } catch (IOException e2) {
      throw new IllegalStateException();
    } catch (NoSuchAlgorithmException e) {
      throw new IllegalStateException(e);
    } catch (InvalidKeySpecException e) {
      throw new IllegalStateException(e);
    }
  }
}

```