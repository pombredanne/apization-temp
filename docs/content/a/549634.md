---
title: "[Q#546365][A#549634] UTF-8 text is garbled when form is posted as multipart/form-data"
question_title: "UTF-8 text is garbled when form is posted as multipart/form-data"
question_text: "I'm uploading a file to the server. The file upload HTML form has 2 fields: When the form is submitted, the file contents are received properly. However, when the file name (point 1 above) is read, it is garbled. ASCII characters are displayed properly. When the name is given in some other language (German, French etc.), there are problems. In the servlet method, the request's character encoding is set to UTF-8. I even tried doing a filter as mentioned - How can I make this code to submit a UTF-8 form textarea with jQuery/Ajax work? - but it doesn't seem to work. Only the filename seems to be garbled. The MySQL table where the file name goes supports UTF-8. I gave random non-English characters & they are stored/displayed properly. Using Fiddler, I monitored the request & all the POST data is passed correctly. I'm trying to identify how/where the data could get garbled. Any help will be greatly appreciated."
answer_text: "I had the same problem using Apache commons-fileupload. I did not find out what causes the problems especially because I have the UTF-8 encoding in the following places: 1. HTML meta tag 2. Form accept-charset attribute 3. Tomcat filter on every request that sets the \"UTF-8\" encoding -> My solution was to especially convert Strings from ISO-8859-1 (or whatever is the default encoding of your platform) to UTF-8: hope that helps Edit: starting with Java 8 you can also use the following:"
apization_code: "package com.stackoverflow.api;  import java.nio.charset.StandardCharsets;  /**  * UTF-8 text is garbled when form is posted as multipart/form-data  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/549634\">https://stackoverflow.com/a/549634</a>  */ public class APIzator549634 {    public static void garble() throws RuntimeException {     new String(s.getBytes(\"iso-8859-1\"), \"UTF-8\");     new String(s.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);   } }"
---

https://stackoverflow.com/q/546365

I&#x27;m uploading a file to the server. The file upload HTML form has 2 fields:
When the form is submitted, the file contents are received properly. However, when the file name (point 1 above) is read, it is garbled. ASCII characters are displayed properly. When the name is given in some other language (German, French etc.), there are problems.
In the servlet method, the request&#x27;s character encoding is set to UTF-8. I even tried doing a filter as mentioned - How can I make this code to submit a UTF-8 form textarea with jQuery/Ajax work? - but it doesn&#x27;t seem to work. Only the filename seems to be garbled.
The MySQL table where the file name goes supports UTF-8. I gave random non-English characters &amp; they are stored/displayed properly.
Using Fiddler, I monitored the request &amp; all the POST data is passed correctly. I&#x27;m trying to identify how/where the data could get garbled. Any help will be greatly appreciated.



## Original code snippet

https://stackoverflow.com/a/549634

I had the same problem using Apache commons-fileupload.
I did not find out what causes the problems especially because I have the UTF-8 encoding in the following places:
1. HTML meta tag
2. Form accept-charset attribute
3. Tomcat filter on every request that sets the &quot;UTF-8&quot; encoding
-&gt; My solution was to especially convert Strings from ISO-8859-1 (or whatever is the default encoding of your platform) to UTF-8:
hope that helps
Edit: starting with Java 8 you can also use the following:

```java
new String (s.getBytes ("iso-8859-1"), "UTF-8");
new String (s.getBytes (StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);
```

## Produced APIzation

[`APIzator549634.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/apizations/java/APIzator549634.java)

```java
package com.stackoverflow.api;

import java.nio.charset.StandardCharsets;

/**
 * UTF-8 text is garbled when form is posted as multipart/form-data
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/549634">https://stackoverflow.com/a/549634</a>
 */
public class APIzator549634 {

  public static void garble() throws RuntimeException {
    new String(s.getBytes("iso-8859-1"), "UTF-8");
    new String(s.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);
  }
}

```