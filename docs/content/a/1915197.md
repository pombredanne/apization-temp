---
title: "[Q#1915166][A#1915197] How to get the insert ID in JDBC?"
question_title: "How to get the insert ID in JDBC?"
question_text: "I want to INSERT a record in a database (which is Microsoft SQL Server in my case) using JDBC in Java. At the same time, I want to obtain the insert ID. How can I achieve this using JDBC API?"
answer_text: "If it is an auto generated key, then you can use Statement#getGeneratedKeys() for this. You need to call it on the same Statement as the one being used for the INSERT. You first need to create the statement using Statement.RETURN_GENERATED_KEYS to notify the JDBC driver to return the keys. Here's a basic example: Note that you're dependent on the JDBC driver as to whether it works. Currently, most of the last versions will work, but if I am correct, Oracle JDBC driver is still somewhat troublesome with this. MySQL and DB2 already supported it for ages. PostgreSQL started to support it not long ago. I can't comment about MSSQL as I've never used it. For Oracle, you can invoke a CallableStatement with a RETURNING clause or a SELECT CURRVAL(sequencename) (or whatever DB-specific syntax to do so) directly after the INSERT in the same transaction to obtain the last generated key. See also this answer."
apization_code: "package com.stackoverflow.api;  import com.google.appengine.api.users.User; import java.sql.Connection; import java.sql.PreparedStatement; import java.sql.ResultSet; import java.sql.SQLException; import java.sql.Statement;  /**  * How to get the insert ID in JDBC?  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/1915197\">https://stackoverflow.com/a/1915197</a>  */ public class APIzator1915197 {    public static void create(User user) throws SQLException {     try (       Connection connection = dataSource.getConnection();       PreparedStatement statement = connection.prepareStatement(         SQL_INSERT,         Statement.RETURN_GENERATED_KEYS       )     ) {       statement.setString(1, user.getName());       statement.setString(2, user.getPassword());       statement.setString(3, user.getEmail());       // ...       int affectedRows = statement.executeUpdate();       if (affectedRows == 0) {         throw new SQLException(\"Creating user failed, no rows affected.\");       }       try (ResultSet generatedKeys = statement.getGeneratedKeys()) {         if (generatedKeys.next()) {           user.setId(generatedKeys.getLong(1));         } else {           throw new SQLException(\"Creating user failed, no ID obtained.\");         }       }     }   } }"
---

https://stackoverflow.com/q/1915166

I want to INSERT a record in a database (which is Microsoft SQL Server in my case) using JDBC in Java. At the same time, I want to obtain the insert ID. How can I achieve this using JDBC API?



## Original code snippet

https://stackoverflow.com/a/1915197

If it is an auto generated key, then you can use Statement#getGeneratedKeys() for this. You need to call it on the same Statement as the one being used for the INSERT. You first need to create the statement using Statement.RETURN_GENERATED_KEYS to notify the JDBC driver to return the keys.
Here&#x27;s a basic example:
Note that you&#x27;re dependent on the JDBC driver as to whether it works. Currently, most of the last versions will work, but if I am correct, Oracle JDBC driver is still somewhat troublesome with this. MySQL and DB2 already supported it for ages. PostgreSQL started to support it not long ago. I can&#x27;t comment about MSSQL as I&#x27;ve never used it.
For Oracle, you can invoke a CallableStatement with a RETURNING clause or a SELECT CURRVAL(sequencename) (or whatever DB-specific syntax to do so) directly after the INSERT in the same transaction to obtain the last generated key. See also this answer.

<div class="code-logo"><img src="/stackoverflow.png" /></div>

```java
public void create(User user) throws SQLException {
    try (
        Connection connection = dataSource.getConnection();
        PreparedStatement statement = connection.prepareStatement(SQL_INSERT,
                                      Statement.RETURN_GENERATED_KEYS);
    ) {
        statement.setString(1, user.getName());
        statement.setString(2, user.getPassword());
        statement.setString(3, user.getEmail());
        // ...

        int affectedRows = statement.executeUpdate();

        if (affectedRows == 0) {
            throw new SQLException("Creating user failed, no rows affected.");
        }

        try (ResultSet generatedKeys = statement.getGeneratedKeys()) {
            if (generatedKeys.next()) {
                user.setId(generatedKeys.getLong(1));
            }
            else {
                throw new SQLException("Creating user failed, no ID obtained.");
            }
        }
    }
}
```

## Produced APIzation

[`APIzator1915197.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/search/APIzator1915197.java)

<div class="code-logo"><img src="/apizator.png" /></div>

```java
package com.stackoverflow.api;

import com.google.appengine.api.users.User;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

/**
 * How to get the insert ID in JDBC?
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/1915197">https://stackoverflow.com/a/1915197</a>
 */
public class APIzator1915197 {

  public static void create(User user) throws SQLException {
    try (
      Connection connection = dataSource.getConnection();
      PreparedStatement statement = connection.prepareStatement(
        SQL_INSERT,
        Statement.RETURN_GENERATED_KEYS
      )
    ) {
      statement.setString(1, user.getName());
      statement.setString(2, user.getPassword());
      statement.setString(3, user.getEmail());
      // ...
      int affectedRows = statement.executeUpdate();
      if (affectedRows == 0) {
        throw new SQLException("Creating user failed, no rows affected.");
      }
      try (ResultSet generatedKeys = statement.getGeneratedKeys()) {
        if (generatedKeys.next()) {
          user.setId(generatedKeys.getLong(1));
        } else {
          throw new SQLException("Creating user failed, no ID obtained.");
        }
      }
    }
  }
}

```