---
title: "[Q#2469451][A#2469587] Upload files from Java client to a HTTP server"
question_title: "Upload files from Java client to a HTTP server"
question_text: "I'd like to upload a few files to a HTTP server. Basically what I need is some sort of a POST request to the server with a few parameters and the files. I've seen examples of just uploading files, but didn't find how to also pass additional parameters. What's the simplest and free solution of doing this? Does anyone have any file upload examples that I could study? I've been googling for a few hours, but (maybe it's just one of those days) couldn't find exactly what I needed. The best solution would be something that doesn't involve any third party classes or libraries."
answer_text: "You'd normally use java.net.URLConnection to fire HTTP requests. You'd also normally use multipart/form-data encoding for mixed POST content (binary and character data). Click the link, it contains information and an example how to compose a multipart/form-data request body. The specification is in more detail described in RFC2388. Here's a kickoff example: This code is less verbose when you use a 3rd party library like Apache Commons HttpComponents Client. The Apache Commons FileUpload as some incorrectly suggest here is only of interest in the server side. You can't use and don't need it at the client side."
apization_code: "package com.stackoverflow.api;  import com.google.appengine.repackaged.com.google.common.io.Files; import java.io.File; import java.io.OutputStream; import java.io.OutputStreamWriter; import java.io.PrintWriter; import java.net.HttpURLConnection; import java.net.URLConnection;  /**  * Upload files from Java client to a HTTP server  *  * @author APIzator  * @see <a href=\"https://stackoverflow.com/a/2469587\">https://stackoverflow.com/a/2469587</a>  */ public class APIzator2469587 {    public static int file(     String url,     String charset,     String param,     String CRLF,     String str1   )     throws RuntimeException {     File textFile = new File(str1);     File binaryFile = new File(\"/path/to/file.bin\");     // Just generate some unique random value.     String boundary = Long.toHexString(System.currentTimeMillis());     URLConnection connection = new URL(url).openConnection();     connection.setDoOutput(true);     connection.setRequestProperty(       \"Content-Type\",       \"multipart/form-data; boundary=\" + boundary     );     try (       OutputStream output = connection.getOutputStream();       PrintWriter writer = new PrintWriter(         new OutputStreamWriter(output, charset),         true       )     ) {       // Send normal param.       writer.append(\"--\" + boundary).append(CRLF);       writer         .append(\"Content-Disposition: form-data; name=\\\"param\\\"\")         .append(CRLF);       writer         .append(\"Content-Type: text/plain; charset=\" + charset)         .append(CRLF);       writer.append(CRLF).append(param).append(CRLF).flush();       // Send text file.       writer.append(\"--\" + boundary).append(CRLF);       writer         .append(           \"Content-Disposition: form-data; name=\\\"textFile\\\"; filename=\\\"\" +           textFile.getName() +           \"\\\"\"         )         .append(CRLF);       // Text file itself must be saved in this charset!       writer         .append(\"Content-Type: text/plain; charset=\" + charset)         .append(CRLF);       writer.append(CRLF).flush();       Files.copy(textFile.toPath(), output);       // Important before continuing with writer!       output.flush();       // CRLF is important! It indicates end of boundary.       writer.append(CRLF).flush();       // Send binary file.       writer.append(\"--\" + boundary).append(CRLF);       writer         .append(           \"Content-Disposition: form-data; name=\\\"binaryFile\\\"; filename=\\\"\" +           binaryFile.getName() +           \"\\\"\"         )         .append(CRLF);       writer         .append(           \"Content-Type: \" +           URLConnection.guessContentTypeFromName(binaryFile.getName())         )         .append(CRLF);       writer.append(\"Content-Transfer-Encoding: binary\").append(CRLF);       writer.append(CRLF).flush();       Files.copy(binaryFile.toPath(), output);       // Important before continuing with writer!       output.flush();       // CRLF is important! It indicates end of boundary.       writer.append(CRLF).flush();       // End of multipart/form-data.       writer.append(\"--\" + boundary + \"--\").append(CRLF).flush();     }     // Request is lazily fired whenever you need to obtain information about response.     int responseCode = ((HttpURLConnection) connection).getResponseCode();     return responseCode;   } }"
---

https://stackoverflow.com/q/2469451

I&#x27;d like to upload a few files to a HTTP server. Basically what I need is some sort of a POST request to the server with a few parameters and the files. I&#x27;ve seen examples of just uploading files, but didn&#x27;t find how to also pass additional parameters.
What&#x27;s the simplest and free solution of doing this? Does anyone have any file upload examples that I could study? I&#x27;ve been googling for a few hours, but (maybe it&#x27;s just one of those days) couldn&#x27;t find exactly what I needed. The best solution would be something that doesn&#x27;t involve any third party classes or libraries.



## Original code snippet

https://stackoverflow.com/a/2469587

You&#x27;d normally use java.net.URLConnection to fire HTTP requests. You&#x27;d also normally use multipart/form-data encoding for mixed POST content (binary and character data). Click the link, it contains information and an example how to compose a multipart/form-data request body. The specification is in more detail described in RFC2388.
Here&#x27;s a kickoff example:
This code is less verbose when you use a 3rd party library like Apache Commons HttpComponents Client.
The Apache Commons FileUpload as some incorrectly suggest here is only of interest in the server side. You can&#x27;t use and don&#x27;t need it at the client side.

```java
String url = "http://example.com/upload";
String charset = "UTF-8";
String param = "value";
File textFile = new File("/path/to/file.txt");
File binaryFile = new File("/path/to/file.bin");
String boundary = Long.toHexString(System.currentTimeMillis()); // Just generate some unique random value.
String CRLF = "\r\n"; // Line separator required by multipart/form-data.

URLConnection connection = new URL(url).openConnection();
connection.setDoOutput(true);
connection.setRequestProperty("Content-Type", "multipart/form-data; boundary=" + boundary);

try (
    OutputStream output = connection.getOutputStream();
    PrintWriter writer = new PrintWriter(new OutputStreamWriter(output, charset), true);
) {
    // Send normal param.
    writer.append("--" + boundary).append(CRLF);
    writer.append("Content-Disposition: form-data; name=\"param\"").append(CRLF);
    writer.append("Content-Type: text/plain; charset=" + charset).append(CRLF);
    writer.append(CRLF).append(param).append(CRLF).flush();

    // Send text file.
    writer.append("--" + boundary).append(CRLF);
    writer.append("Content-Disposition: form-data; name=\"textFile\"; filename=\"" + textFile.getName() + "\"").append(CRLF);
    writer.append("Content-Type: text/plain; charset=" + charset).append(CRLF); // Text file itself must be saved in this charset!
    writer.append(CRLF).flush();
    Files.copy(textFile.toPath(), output);
    output.flush(); // Important before continuing with writer!
    writer.append(CRLF).flush(); // CRLF is important! It indicates end of boundary.

    // Send binary file.
    writer.append("--" + boundary).append(CRLF);
    writer.append("Content-Disposition: form-data; name=\"binaryFile\"; filename=\"" + binaryFile.getName() + "\"").append(CRLF);
    writer.append("Content-Type: " + URLConnection.guessContentTypeFromName(binaryFile.getName())).append(CRLF);
    writer.append("Content-Transfer-Encoding: binary").append(CRLF);
    writer.append(CRLF).flush();
    Files.copy(binaryFile.toPath(), output);
    output.flush(); // Important before continuing with writer!
    writer.append(CRLF).flush(); // CRLF is important! It indicates end of boundary.

    // End of multipart/form-data.
    writer.append("--" + boundary + "--").append(CRLF).flush();
}

// Request is lazily fired whenever you need to obtain information about response.
int responseCode = ((HttpURLConnection) connection).getResponseCode();
System.out.println(responseCode); // Should be 200
```

## Produced APIzation

[`APIzator2469587.java`](https://github.com/pasqualesalza/apization-temp-data/raw/master/apizations/java/APIzator2469587.java)

```java
package com.stackoverflow.api;

import com.google.appengine.repackaged.com.google.common.io.Files;
import java.io.File;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.net.HttpURLConnection;
import java.net.URLConnection;

/**
 * Upload files from Java client to a HTTP server
 *
 * @author APIzator
 * @see <a href="https://stackoverflow.com/a/2469587">https://stackoverflow.com/a/2469587</a>
 */
public class APIzator2469587 {

  public static int file(
    String url,
    String charset,
    String param,
    String CRLF,
    String str1
  )
    throws RuntimeException {
    File textFile = new File(str1);
    File binaryFile = new File("/path/to/file.bin");
    // Just generate some unique random value.
    String boundary = Long.toHexString(System.currentTimeMillis());
    URLConnection connection = new URL(url).openConnection();
    connection.setDoOutput(true);
    connection.setRequestProperty(
      "Content-Type",
      "multipart/form-data; boundary=" + boundary
    );
    try (
      OutputStream output = connection.getOutputStream();
      PrintWriter writer = new PrintWriter(
        new OutputStreamWriter(output, charset),
        true
      )
    ) {
      // Send normal param.
      writer.append("--" + boundary).append(CRLF);
      writer
        .append("Content-Disposition: form-data; name=\"param\"")
        .append(CRLF);
      writer
        .append("Content-Type: text/plain; charset=" + charset)
        .append(CRLF);
      writer.append(CRLF).append(param).append(CRLF).flush();
      // Send text file.
      writer.append("--" + boundary).append(CRLF);
      writer
        .append(
          "Content-Disposition: form-data; name=\"textFile\"; filename=\"" +
          textFile.getName() +
          "\""
        )
        .append(CRLF);
      // Text file itself must be saved in this charset!
      writer
        .append("Content-Type: text/plain; charset=" + charset)
        .append(CRLF);
      writer.append(CRLF).flush();
      Files.copy(textFile.toPath(), output);
      // Important before continuing with writer!
      output.flush();
      // CRLF is important! It indicates end of boundary.
      writer.append(CRLF).flush();
      // Send binary file.
      writer.append("--" + boundary).append(CRLF);
      writer
        .append(
          "Content-Disposition: form-data; name=\"binaryFile\"; filename=\"" +
          binaryFile.getName() +
          "\""
        )
        .append(CRLF);
      writer
        .append(
          "Content-Type: " +
          URLConnection.guessContentTypeFromName(binaryFile.getName())
        )
        .append(CRLF);
      writer.append("Content-Transfer-Encoding: binary").append(CRLF);
      writer.append(CRLF).flush();
      Files.copy(binaryFile.toPath(), output);
      // Important before continuing with writer!
      output.flush();
      // CRLF is important! It indicates end of boundary.
      writer.append(CRLF).flush();
      // End of multipart/form-data.
      writer.append("--" + boundary + "--").append(CRLF).flush();
    }
    // Request is lazily fired whenever you need to obtain information about response.
    int responseCode = ((HttpURLConnection) connection).getResponseCode();
    return responseCode;
  }
}

```